<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FashionPulse Database Connection Verification</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #fdf2f8 0%, #f3e8ff 100%);
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(45deg, #ec4899, #f472b6);
            color: white;
            border-radius: 10px;
        }
        .status-section {
            margin: 25px 0;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
        }
        .status-online {
            border-color: #10b981;
            background: #f0fdf4;
        }
        .status-loading {
            border-color: #f59e0b;
            background: #fffbeb;
        }
        .status-offline {
            border-color: #ef4444;
            background: #fef2f2;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-button {
            background: linear-gradient(45deg, #ec4899, #f472b6);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(236, 72, 153, 0.3);
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .product-card {
            border: 1px solid #ec4899;
            border-radius: 8px;
            padding: 15px;
            background: #fdf2f8;
            text-align: center;
        }
        .product-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .results {
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
            min-height: 100px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ec4899;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .stats-box {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üóÑÔ∏è FashionPulse Database Connection Verification</h1>
            <p>Testing connection to fashiopulse.clothing database with 285 products</p>
        </div>

        <div id="backendStatus" class="status-section status-loading">
            <h3>üîß Backend API Status</h3>
            <p><span class="loading"></span> Checking backend connection...</p>
        </div>

        <div id="databaseStatus" class="status-section status-loading">
            <h3>üóÑÔ∏è Database Status</h3>
            <p><span class="loading"></span> Checking database connection...</p>
        </div>

        <div id="frontendStatus" class="status-section status-loading">
            <h3>üåê Frontend Status</h3>
            <p><span class="loading"></span> Checking frontend accessibility...</p>
        </div>

        <div class="status-section">
            <h3>üß™ Database Connection Tests</h3>
            <div class="test-grid">
                <button class="test-button" onclick="testProductCount()">
                    üìä Test Product Count
                </button>
                <button class="test-button" onclick="testProductSearch()">
                    üîç Test Product Search
                </button>
                <button class="test-button" onclick="testCategoryProducts()">
                    üè∑Ô∏è Test Category Products
                </button>
                <button class="test-button" onclick="testProductDetail()">
                    üì¶ Test Product Detail
                </button>
                <button class="test-button" onclick="testAllProducts()">
                    üõçÔ∏è Show All Products
                </button>
                <button class="test-button" onclick="testRandomProducts()">
                    üé≤ Random Products
                </button>
            </div>
        </div>

        <div class="stats-box">
            <h4>üìä Database Information</h4>
            <div id="dbStats">
                <p><strong>Database:</strong> fashiopulse</p>
                <p><strong>Table:</strong> clothing</p>
                <p><strong>Expected Products:</strong> 285</p>
                <p><strong>Backend URL:</strong> http://localhost:5000/api</p>
                <p><strong>Frontend URL:</strong> http://localhost:3000</p>
            </div>
        </div>

        <div class="results" id="results">
            <h3>üìã Test Results</h3>
            <p>Click any test button above to verify database connectivity...</p>
        </div>
    </div>

    <script>
        // Check system status on load
        async function checkSystemStatus() {
            // Check backend
            try {
                const backendResponse = await fetch('http://localhost:5000/api/cache/count');
                const backendData = await backendResponse.json();
                
                document.getElementById('backendStatus').className = 'status-section status-online';
                document.getElementById('backendStatus').innerHTML = `
                    <h3>üîß Backend API Status</h3>
                    <p>‚úÖ <strong>Online</strong> - Connected to http://localhost:5000</p>
                    <p>üìä Products in database: ${backendData.cached_products}</p>
                `;
            } catch (error) {
                document.getElementById('backendStatus').className = 'status-section status-offline';
                document.getElementById('backendStatus').innerHTML = `
                    <h3>üîß Backend API Status</h3>
                    <p>‚ùå <strong>Offline</strong> - Cannot connect to backend</p>
                    <p>Please run: <code>python start_backend.py</code></p>
                `;
            }

            // Check database through backend
            try {
                const dbResponse = await fetch('http://localhost:5000/api/products/search?query=clothing&limit=1');
                const dbData = await dbResponse.json();
                
                document.getElementById('databaseStatus').className = 'status-section status-online';
                document.getElementById('databaseStatus').innerHTML = `
                    <h3>üóÑÔ∏è Database Status</h3>
                    <p>‚úÖ <strong>Connected</strong> - fashiopulse.clothing table accessible</p>
                    <p>üîó Products can be fetched successfully</p>
                `;
            } catch (error) {
                document.getElementById('databaseStatus').className = 'status-section status-offline';
                document.getElementById('databaseStatus').innerHTML = `
                    <h3>üóÑÔ∏è Database Status</h3>
                    <p>‚ùå <strong>Disconnected</strong> - Cannot access database</p>
                    <p>Check MySQL server and database configuration</p>
                `;
            }

            // Check frontend
            try {
                const frontendResponse = await fetch('http://localhost:3000');
                
                document.getElementById('frontendStatus').className = 'status-section status-online';
                document.getElementById('frontendStatus').innerHTML = `
                    <h3>üåê Frontend Status</h3>
                    <p>‚úÖ <strong>Accessible</strong> - http://localhost:3000</p>
                    <p>üîó Ready to display database products</p>
                `;
            } catch (error) {
                document.getElementById('frontendStatus').className = 'status-section status-loading';
                document.getElementById('frontendStatus').innerHTML = `
                    <h3>üåê Frontend Status</h3>
                    <p>‚ö†Ô∏è <strong>Not Accessible</strong> - May still be starting</p>
                    <p>Please run: <code>npm run dev</code></p>
                `;
            }
        }

        async function testProductCount() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h3>üìã Test Results</h3><p><span class="loading"></span> Testing product count...</p>';
            
            try {
                const response = await fetch('http://localhost:5000/api/cache/count');
                const data = await response.json();
                
                resultsDiv.innerHTML = `
                    <h3>üìã Test Results</h3>
                    <div class="stats-box">
                        <h4>‚úÖ Product Count Test - SUCCESS</h4>
                        <p><strong>Total Products:</strong> ${data.cached_products}</p>
                        <p><strong>Database:</strong> fashiopulse.clothing</p>
                        <p><strong>Status:</strong> All products accessible via API</p>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <h3>üìã Test Results</h3>
                    <div class="status-section status-offline">
                        <h4>‚ùå Product Count Test - FAILED</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>Check if backend server is running</p>
                    </div>
                `;
            }
        }

        async function testProductSearch() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h3>üìã Test Results</h3><p><span class="loading"></span> Testing product search...</p>';
            
            try {
                const response = await fetch('http://localhost:5000/api/products/search?query=dress&limit=5');
                const data = await response.json();
                
                let html = `
                    <h3>üìã Test Results</h3>
                    <div class="stats-box">
                        <h4>‚úÖ Product Search Test - SUCCESS</h4>
                        <p><strong>Query:</strong> "dress"</p>
                        <p><strong>Results Found:</strong> ${data.products.length}</p>
                    </div>
                `;
                
                if (data.products.length > 0) {
                    html += '<div class="product-grid">';
                    data.products.forEach(product => {
                        html += `
                            <div class="product-card">
                                <img src="${product.image_url}" alt="${product.title}" class="product-image" 
                                     onerror="this.src='https://via.placeholder.com/200x150/ec4899/ffffff?text=No+Image'">
                                <h5>${product.title}</h5>
                                <p><strong>‚Çπ${product.price.toLocaleString()}</strong></p>
                                <p>${product.category} | ${product.gender}</p>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                resultsDiv.innerHTML = html;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <h3>üìã Test Results</h3>
                    <div class="status-section status-offline">
                        <h4>‚ùå Product Search Test - FAILED</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        async function testCategoryProducts() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h3>üìã Test Results</h3><p><span class="loading"></span> Testing category products...</p>';
            
            try {
                const response = await fetch('http://localhost:5000/api/products/category/fashion?limit=6');
                const data = await response.json();
                
                let html = `
                    <h3>üìã Test Results</h3>
                    <div class="stats-box">
                        <h4>‚úÖ Category Products Test - SUCCESS</h4>
                        <p><strong>Category:</strong> Fashion</p>
                        <p><strong>Results Found:</strong> ${data.products.length}</p>
                    </div>
                `;
                
                if (data.products.length > 0) {
                    html += '<div class="product-grid">';
                    data.products.forEach(product => {
                        html += `
                            <div class="product-card">
                                <img src="${product.image_url}" alt="${product.title}" class="product-image"
                                     onerror="this.src='https://via.placeholder.com/200x150/ec4899/ffffff?text=No+Image'">
                                <h5>${product.title}</h5>
                                <p><strong>‚Çπ${product.price.toLocaleString()}</strong></p>
                                <p>${product.category} | ${product.gender}</p>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                resultsDiv.innerHTML = html;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <h3>üìã Test Results</h3>
                    <div class="status-section status-offline">
                        <h4>‚ùå Category Products Test - FAILED</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        async function testProductDetail() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h3>üìã Test Results</h3><p><span class="loading"></span> Testing product detail...</p>';
            
            try {
                const response = await fetch('http://localhost:5000/api/products/1');
                const data = await response.json();
                
                const product = data.product;
                resultsDiv.innerHTML = `
                    <h3>üìã Test Results</h3>
                    <div class="stats-box">
                        <h4>‚úÖ Product Detail Test - SUCCESS</h4>
                        <p><strong>Product ID:</strong> ${product.id}</p>
                        <p><strong>Name:</strong> ${product.title}</p>
                        <p><strong>Price:</strong> ‚Çπ${product.price.toLocaleString()}</p>
                        <p><strong>Category:</strong> ${product.category}</p>
                        <p><strong>Gender:</strong> ${product.gender}</p>
                        <p><strong>Description:</strong> ${product.description.substring(0, 100)}...</p>
                    </div>
                    <div class="product-grid">
                        <div class="product-card">
                            <img src="${product.image_url}" alt="${product.title}" class="product-image"
                                 onerror="this.src='https://via.placeholder.com/200x150/ec4899/ffffff?text=No+Image'">
                            <h5>${product.title}</h5>
                            <p><strong>‚Çπ${product.price.toLocaleString()}</strong></p>
                            <p>${product.category} | ${product.gender}</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <h3>üìã Test Results</h3>
                    <div class="status-section status-offline">
                        <h4>‚ùå Product Detail Test - FAILED</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        async function testAllProducts() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h3>üìã Test Results</h3><p><span class="loading"></span> Loading all products...</p>';
            
            try {
                const response = await fetch('http://localhost:5000/api/products/category/fashion?limit=12');
                const data = await response.json();
                
                let html = `
                    <h3>üìã Test Results</h3>
                    <div class="stats-box">
                        <h4>‚úÖ All Products Test - SUCCESS</h4>
                        <p><strong>Showing:</strong> ${data.products.length} products (limited display)</p>
                        <p><strong>Total Available:</strong> 285 products in database</p>
                        <p><strong>Source:</strong> fashiopulse.clothing table</p>
                    </div>
                `;
                
                if (data.products.length > 0) {
                    html += '<div class="product-grid">';
                    data.products.forEach(product => {
                        html += `
                            <div class="product-card">
                                <img src="${product.image_url}" alt="${product.title}" class="product-image"
                                     onerror="this.src='https://via.placeholder.com/200x150/ec4899/ffffff?text=No+Image'">
                                <h5>${product.title}</h5>
                                <p><strong>‚Çπ${product.price.toLocaleString()}</strong></p>
                                <p>${product.category} | ${product.gender}</p>
                                <p style="font-size: 11px; color: #666;">ID: ${product.id}</p>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                resultsDiv.innerHTML = html;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <h3>üìã Test Results</h3>
                    <div class="status-section status-offline">
                        <h4>‚ùå All Products Test - FAILED</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        async function testRandomProducts() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h3>üìã Test Results</h3><p><span class="loading"></span> Getting random products...</p>';
            
            try {
                // Get random products by using different search terms
                const queries = ['shirt', 'dress', 'jeans', 'top'];
                const randomQuery = queries[Math.floor(Math.random() * queries.length)];
                
                const response = await fetch(`http://localhost:5000/api/products/search?query=${randomQuery}&limit=8`);
                const data = await response.json();
                
                let html = `
                    <h3>üìã Test Results</h3>
                    <div class="stats-box">
                        <h4>‚úÖ Random Products Test - SUCCESS</h4>
                        <p><strong>Search Query:</strong> "${randomQuery}"</p>
                        <p><strong>Results Found:</strong> ${data.products.length}</p>
                        <p><strong>Database Response:</strong> Real-time data from MySQL</p>
                    </div>
                `;
                
                if (data.products.length > 0) {
                    html += '<div class="product-grid">';
                    data.products.forEach(product => {
                        html += `
                            <div class="product-card">
                                <img src="${product.image_url}" alt="${product.title}" class="product-image"
                                     onerror="this.src='https://via.placeholder.com/200x150/ec4899/ffffff?text=No+Image'">
                                <h5>${product.title}</h5>
                                <p><strong>‚Çπ${product.price.toLocaleString()}</strong></p>
                                <p>${product.category} | ${product.gender}</p>
                                <p style="font-size: 11px; color: #666;">Stock: ${product.stock || 'N/A'}</p>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                resultsDiv.innerHTML = html;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <h3>üìã Test Results</h3>
                    <div class="status-section status-offline">
                        <h4>‚ùå Random Products Test - FAILED</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        // Initialize on page load
        window.onload = function() {
            checkSystemStatus();
        };
    </script>
</body>
</html>