<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Product Chat Test - FashionPulse</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #fdf2f8 0%, #f3e8ff 100%);
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(45deg, #ec4899, #f472b6);
            color: white;
            border-radius: 10px;
        }
        .test-section {
            margin: 25px 0;
            padding: 20px;
            border: 2px solid #ec4899;
            border-radius: 10px;
            background: #fdf2f8;
        }
        .query-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .query-button {
            background: linear-gradient(45deg, #ec4899, #f472b6);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-align: left;
        }
        .query-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(236, 72, 153, 0.3);
        }
        .product-card {
            border: 2px solid #ec4899;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .product-details {
            text-align: left;
        }
        .product-name {
            font-size: 18px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 10px;
        }
        .product-description {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .product-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .product-price {
            font-size: 24px;
            font-weight: bold;
            color: #ec4899;
        }
        .product-stock {
            font-size: 14px;
            color: #10b981;
        }
        .color-gender {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        .color-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .color-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #d1d5db;
        }
        .click-indicator {
            text-align: center;
            padding: 10px;
            background: #fdf2f8;
            border-radius: 8px;
            color: #ec4899;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .click-indicator:hover {
            background: #ec4899;
            color: white;
        }
        #results {
            margin-top: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
            min-height: 200px;
            border: 1px solid #e2e8f0;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ec4899;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .feature-list {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõçÔ∏è Enhanced Product Chat Test</h1>
            <p>Testing detailed product display with images, descriptions, and click-to-view functionality</p>
        </div>

        <div class="feature-list">
            <h3>‚ú® New Features Being Tested:</h3>
            <ul>
                <li>üñºÔ∏è <strong>Detailed Product Cards</strong> - Images, names, descriptions, colors, prices</li>
                <li>üîó <strong>Click-to-View</strong> - Products open in new tab, chat stays available</li>
                <li>üíæ <strong>Session Persistence</strong> - Chat history saved until logout</li>
                <li>üì± <strong>Enhanced UI</strong> - Better product layout and visual design</li>
                <li>üé® <strong>Color Indicators</strong> - Visual color representation</li>
                <li>üì¶ <strong>Stock Information</strong> - Real-time stock status</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üîç Product Search Tests</h3>
            <p>These queries will return detailed product cards with all information</p>
            <div class="query-grid">
                <button class="query-button" onclick="testProductQuery('show me red dresses under 2000')">
                    üëó Red Dresses Under ‚Çπ2000
                </button>
                <button class="query-button" onclick="testProductQuery('find jeans for men')">
                    üëñ Men's Jeans
                </button>
                <button class="query-button" onclick="testProductQuery('looking for ethnic wear for women')">
                    ü•ª Women's Ethnic Wear
                </button>
                <button class="query-button" onclick="testProductQuery('blue shirts under 1500')">
                    üëî Blue Shirts Under ‚Çπ1500
                </button>
                <button class="query-button" onclick="testProductQuery('show me tops for women')">
                    üëö Women's Tops
                </button>
                <button class="query-button" onclick="testProductQuery('find black dresses')">
                    üñ§ Black Dresses
                </button>
            </div>
        </div>

        <div class="test-section">
            <h3>üí¨ E-commerce Support Tests</h3>
            <p>These queries test non-product support features</p>
            <div class="query-grid">
                <button class="query-button" onclick="testProductQuery('what is your return policy?')">
                    üîÑ Return Policy
                </button>
                <button class="query-button" onclick="testProductQuery('how long does shipping take?')">
                    üì¶ Shipping Information
                </button>
                <button class="query-button" onclick="testProductQuery('what payment methods do you accept?')">
                    üí≥ Payment Methods
                </button>
            </div>
        </div>

        <div id="results">
            <h3>üìã Test Results</h3>
            <p>Click any button above to test the enhanced product display...</p>
        </div>
    </div>

    <script>
        async function testProductQuery(query) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <h3>üìã Test Results</h3>
                <p><span class="loading"></span> Testing query: "${query}"...</p>
            `;
            
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: query })
                });
                
                const data = await response.json();
                
                if (response.ok && data.status === 'success') {
                    let html = `
                        <h3>üìã Test Results for: "${query}"</h3>
                        <div style="background: #f0fdf4; border: 1px solid #10b981; border-radius: 8px; padding: 15px; margin: 15px 0;">
                            <h4>‚úÖ Chat Response:</h4>
                            <p>${formatResponse(data.response)}</p>
                        </div>
                    `;
                    
                    if (data.products && data.products.length > 0) {
                        html += `
                            <div style="background: #fdf2f8; border: 1px solid #ec4899; border-radius: 8px; padding: 15px; margin: 15px 0;">
                                <h4>üõçÔ∏è Products Found (${data.products.length}):</h4>
                                <p>Each product shows: Image, Name, Description, Color, Price, Stock, Category</p>
                            </div>
                        `;
                        
                        data.products.slice(0, 3).forEach((product, index) => {
                            const colorStyle = getColorStyle(product.color);
                            html += `
                                <div class="product-card">
                                    <div style="display: flex; gap: 20px;">
                                        <div style="flex: 1;">
                                            <img src="${product.product_image}" 
                                                 alt="${product.product_name}" 
                                                 class="product-image"
                                                 onerror="this.src='https://via.placeholder.com/300x200/ec4899/ffffff?text=${encodeURIComponent(product.product_name.substring(0, 15))}'">
                                        </div>
                                        <div style="flex: 2;" class="product-details">
                                            <div class="product-name">#${index + 1} ${product.product_name}</div>
                                            <div class="product-description">
                                                ${product.product_description || 'Premium quality clothing item crafted with attention to detail. Perfect for style-conscious individuals.'}
                                            </div>
                                            <div class="color-gender">
                                                <div class="color-indicator">
                                                    <div class="color-dot" style="background-color: ${colorStyle}"></div>
                                                    <span><strong>Color:</strong> ${product.color}</span>
                                                </div>
                                                <div>
                                                    <span><strong>Gender:</strong> ${product.gender}</span>
                                                </div>
                                            </div>
                                            <div class="product-meta">
                                                <div class="product-price">‚Çπ${product.price.toLocaleString()}</div>
                                                <div class="product-stock">
                                                    ${product.stock > 0 ? `‚úÖ ${product.stock} in stock` : '‚ùå Out of stock'}
                                                </div>
                                            </div>
                                            <div style="font-size: 14px; color: #6b7280; margin-bottom: 15px;">
                                                <strong>Category:</strong> ${product.product_category} | <strong>ID:</strong> ${product.product_id}
                                            </div>
                                            <div class="click-indicator" onclick="simulateProductClick('${product.product_id}', '${product.product_name}')">
                                                üëÜ Click to view full product details üîó
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        if (data.products.length > 3) {
                            html += `
                                <div style="text-align: center; padding: 15px; background: #fef3c7; border-radius: 8px; margin: 15px 0;">
                                    <strong>+${data.products.length - 3} more products available</strong><br>
                                    <small>In the actual chat, users can scroll to see all products</small>
                                </div>
                            `;
                        }
                    } else {
                        html += `
                            <div style="background: #fef2f2; border: 1px solid #ef4444; border-radius: 8px; padding: 15px; margin: 15px 0;">
                                <h4>‚ÑπÔ∏è No Products Found</h4>
                                <p>This query returned general information instead of products.</p>
                            </div>
                        `;
                    }
                    
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = `
                        <h3>üìã Test Results</h3>
                        <div style="background: #fef2f2; border: 1px solid #ef4444; border-radius: 8px; padding: 15px;">
                            <h4>‚ùå Test Failed</h4>
                            <p><strong>Error:</strong> ${data.error || 'Unknown error'}</p>
                            <p>Make sure the chat agent server is running on port 5001</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <h3>üìã Test Results</h3>
                    <div style="background: #fef2f2; border: 1px solid #ef4444; border-radius: 8px; padding: 15px;">
                        <h4>‚ùå Connection Error</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>Please ensure the chat agent server is running:</p>
                        <code>python chat_agent/lightweight_api_server.py</code>
                    </div>
                `;
            }
        }

        function formatResponse(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br/>')
                .replace(/‚Ä¢ /g, '‚Ä¢ ')
                .replace(/(\d+)Ô∏è‚É£/g, '<span style="color: #ec4899; font-weight: bold;">$1Ô∏è‚É£</span>');
        }

        function getColorStyle(color) {
            const colorMap = {
                'red': '#ef4444',
                'blue': '#3b82f6',
                'black': '#1f2937',
                'white': '#f9fafb',
                'green': '#10b981',
                'yellow': '#f59e0b',
                'pink': '#ec4899',
                'purple': '#8b5cf6',
                'brown': '#92400e',
                'grey': '#6b7280',
                'gray': '#6b7280'
            };
            return colorMap[color.toLowerCase()] || '#6b7280';
        }

        function simulateProductClick(productId, productName) {
            alert(`üîó In the actual chat, this would open:\n\n"${productName}"\n\nProduct Page: /products/${productId}\n\n‚ú® The product would open in a new tab while keeping the chat available for continued conversation!`);
        }

        // Auto-run a test on page load
        window.onload = function() {
            setTimeout(() => {
                testProductQuery('show me red dresses under 2000');
            }, 1000);
        };
    </script>
</body>
</html>