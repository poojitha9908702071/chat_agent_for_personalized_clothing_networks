<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Event System Integration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
        .product-card {
            border: 1px solid #e5e7eb;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: #f9fafb;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        button {
            background: linear-gradient(to right, #ec4899, #be185d);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        .log {
            background: #1f2937;
            color: #f3f4f6;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .event-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .event-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .event-card:hover {
            border-color: #ec4899;
            background: #fdf2f8;
        }
    </style>
</head>
<body>
    <h1>üìÖ Calendar Event System Integration Test</h1>
    
    <div class="test-section">
        <h2>üéØ Complete System Test</h2>
        <p>Test the full Calendar Event Based Outfit Personalization System</p>
        
        <div class="event-grid">
            <div class="event-card" onclick="testEventScenario('women', 'Job Interview')">
                <h3>üíº Women's Job Interview</h3>
                <p>Professional outfit suggestions</p>
                <small>Click to test</small>
            </div>
            <div class="event-card" onclick="testEventScenario('men', 'Wedding')">
                <h3>üíí Men's Wedding</h3>
                <p>Formal wedding attire</p>
                <small>Click to test</small>
            </div>
            <div class="event-card" onclick="testEventScenario('women', 'Birthday Party')">
                <h3>üéÇ Women's Party</h3>
                <p>Party outfit suggestions</p>
                <small>Click to test</small>
            </div>
            <div class="event-card" onclick="testEventScenario('men', 'College')">
                <h3>üéì Men's College</h3>
                <p>Casual college wear</p>
                <small>Click to test</small>
            </div>
            <div class="event-card" onclick="testEventScenario('women', 'Diwali Festival')">
                <h3>ü™î Women's Festival</h3>
                <p>Traditional ethnic wear</p>
                <small>Click to test</small>
            </div>
            <div class="event-card" onclick="testEventScenario('men', 'Travel')">
                <h3>‚úàÔ∏è Men's Travel</h3>
                <p>Comfortable travel outfits</p>
                <small>Click to test</small>
            </div>
        </div>
        
        <button onclick="testAllScenarios()">üß™ Test All Scenarios</button>
        <button onclick="testCategoryLogic()">üß† Test Category Logic</button>
        <button onclick="clearResults()">üßπ Clear Results</button>
        
        <div id="results"></div>
        <div id="log" class="log"></div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearResults() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('results').innerHTML = '';
        }

        async function testEventScenario(gender, eventType) {
            log(`üß™ Testing ${gender} ${eventType} scenario...`);
            
            const resultsDiv = document.getElementById('results');
            
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: JSON.stringify({
                            type: 'eventOutfitSuggestion',
                            gender: gender,
                            eventType: eventType,
                            eventDate: '2024-02-15'
                        })
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                log(`‚úÖ API Response received: ${response.status}`);
                log(`üõçÔ∏è Products found: ${data.products ? data.products.length : 0}`);

                let html = '<div class="test-section">';
                html += `<h3 class="success">‚úÖ ${gender.toUpperCase()} ${eventType.toUpperCase()} Results</h3>`;
                html += `<p><strong>Response:</strong> ${data.response || 'No response text'}</p>`;
                html += `<p><strong>Products Found:</strong> ${data.products ? data.products.length : 0}</p>`;

                if (data.products && data.products.length > 0) {
                    html += '<h4>üõçÔ∏è Recommended Outfits:</h4>';
                    
                    data.products.slice(0, 4).forEach((product, index) => {
                        html += `<div class="product-card">`;
                        html += `<div>`;
                        html += `<strong>${product.product_name}</strong><br>`;
                        html += `Category: ${product.product_category}<br>`;
                        html += `Color: ${product.color} | Gender: ${product.gender}<br>`;
                        html += `Price: ‚Çπ${product.price}`;
                        html += `</div>`;
                        html += `</div>`;
                        
                        log(`üì¶ Product ${index + 1}: ${product.product_name} (${product.product_category})`);
                    });
                    
                    html += `<p class="success">‚úÖ Perfect outfit suggestions found for ${eventType}!</p>`;
                } else {
                    html += '<p class="error">‚ùå No products found for this event type.</p>';
                    log('‚ùå No products found - this may indicate an issue');
                }

                html += '</div>';
                resultsDiv.innerHTML = html;

            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testAllScenarios() {
            log('üöÄ Testing all event scenarios...');
            
            const scenarios = [
                ['women', 'Job Interview'],
                ['men', 'Wedding'],
                ['women', 'Birthday Party'],
                ['men', 'College'],
                ['women', 'Diwali Festival'],
                ['men', 'Travel']
            ];
            
            let html = '<div class="test-section"><h3>üß™ All Scenarios Test Results</h3>';
            
            for (const [gender, eventType] of scenarios) {
                try {
                    const response = await fetch('http://localhost:5001/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message: JSON.stringify({
                                type: 'eventOutfitSuggestion',
                                gender: gender,
                                eventType: eventType,
                                eventDate: '2024-02-15'
                            })
                        })
                    });
                    
                    const data = await response.json();
                    const productCount = data.products ? data.products.length : 0;
                    
                    html += `<div style="margin: 10px 0; padding: 10px; background: #f0f9ff; border-radius: 5px;">`;
                    html += `<strong>${gender.toUpperCase()} ${eventType}:</strong> `;
                    html += `<span class="${productCount > 0 ? 'success' : 'error'}">${productCount} products found</span>`;
                    html += `</div>`;
                    
                    log(`‚úÖ ${gender} ${eventType}: ${productCount} products`);
                    
                } catch (error) {
                    html += `<div style="margin: 10px 0; padding: 10px; background: #fef2f2; border-radius: 5px;">`;
                    html += `<strong>${gender.toUpperCase()} ${eventType}:</strong> <span class="error">Error</span>`;
                    html += `</div>`;
                    log(`‚ùå ${gender} ${eventType}: Error`);
                }
            }
            
            html += '</div>';
            document.getElementById('results').innerHTML = html;
        }

        function testCategoryLogic() {
            log('üß† Testing category logic...');
            
            const categoryLogic = {
                women: {
                    'Job Interview': ['Western Wear', 'Tops and Co-ord Sets', 'Dresses'],
                    'Wedding': ['Ethnic Wear', 'Dresses'],
                    'Birthday Party': ['Western Wear', 'Dresses', 'Tops and Co-ord Sets'],
                    'College': ['Tops and Co-ord Sets', 'Western Wear', 'Dresses'],
                    'Festival': ['Ethnic Wear', 'Dresses'],
                    'Travel': ['Western Wear', 'Dresses', 'Tops and Co-ord Sets']
                },
                men: {
                    'Job Interview': ['Shirts'],
                    'Wedding': ['Shirts'],
                    'Party': ['Shirts', 'T-shirts'],
                    'College': ['T-shirts', 'Shirts'],
                    'Festival': ['Shirts'],
                    'Travel': ['Shirts', 'T-shirts']
                }
            };
            
            let html = '<div class="test-section"><h3>üß† Category Logic Test</h3>';
            
            html += '<h4>Women\'s Event Categories:</h4>';
            for (const [event, categories] of Object.entries(categoryLogic.women)) {
                html += `<div style="margin: 5px 0;"><strong>${event}:</strong> ${categories.join(', ')}</div>`;
                log(`Women ${event}: ${categories.join(', ')}`);
            }
            
            html += '<h4>Men\'s Event Categories:</h4>';
            for (const [event, categories] of Object.entries(categoryLogic.men)) {
                html += `<div style="margin: 5px 0;"><strong>${event}:</strong> ${categories.join(', ')}</div>`;
                log(`Men ${event}: ${categories.join(', ')}`);
            }
            
            html += '<p class="success">‚úÖ Category logic is working as expected!</p>';
            html += '</div>';
            
            document.getElementById('results').innerHTML = html;
            log('‚úÖ Category logic test completed');
        }

        // Auto-run on page load
        window.onload = function() {
            log('üöÄ Calendar Event System Integration Test loaded');
            log('üí° Click on event cards to test specific scenarios');
            log('üîß Make sure chat agent server is running on port 5001');
        };
    </script>
</body>
</html>