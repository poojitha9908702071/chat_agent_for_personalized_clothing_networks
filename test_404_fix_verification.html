<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>404 Fix Verification Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .success { 
            background-color: #d4edda; 
            border-color: #c3e6cb; 
            color: #155724; 
        }
        .error { 
            background-color: #f8d7da; 
            border-color: #f5c6cb; 
            color: #721c24; 
        }
        .loading { 
            background-color: #d1ecf1; 
            border-color: #bee5eb; 
            color: #0c5460; 
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß 404 Fix Verification Test</h1>
        <p>Testing if the missing route decorator fix resolved the "Failed to fetch products: 404 NOT FOUND" error.</p>
        
        <h2>üéØ The Problem</h2>
        <div class="code">
            Error: Failed to fetch products: 404 NOT FOUND<br>
            at searchProducts (backendApi.ts:42:19)<br>
            at loadApiProducts (AIChatBox.tsx:6613:28)
        </div>
        
        <h2>üîß The Fix</h2>
        <div class="code">
            Added missing route decorator:<br>
            @app.route('/api/products/search', methods=['GET'])<br>
            def search_products():
        </div>
        
        <h2>‚úÖ Verification Tests</h2>
        
        <button onclick="testDirectBackendCall()">Test Direct Backend Call</button>
        <button onclick="testFrontendApiService()">Test Frontend API Service</button>
        <button onclick="testBothEndpoints()">Test Both Endpoints</button>
        
        <div id="results"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        
        function addResult(title, status, message) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${status}`;
            resultDiv.innerHTML = `<h3>${title}</h3><p>${message}</p>`;
            resultsDiv.appendChild(resultDiv);
        }
        
        async function testDirectBackendCall() {
            addResult('Direct Backend Call', 'loading', 'Testing direct call to /api/products/search...');
            
            try {
                const url = `${API_URL}/products/search?query=shirts&category=fashion`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                addResult(
                    'Direct Backend Call ‚úÖ', 
                    'success', 
                    `SUCCESS! Found ${data.count} products. The missing route decorator has been fixed.`
                );
                
            } catch (error) {
                addResult(
                    'Direct Backend Call ‚ùå', 
                    'error', 
                    `FAILED: ${error.message}. The route decorator is still missing or backend is not running.`
                );
            }
        }
        
        async function testFrontendApiService() {
            addResult('Frontend API Service', 'loading', 'Testing the exact same call that was failing...');
            
            try {
                // This is the exact same code from services/backendApi.ts
                const query = 'shirts';
                const category = 'fashion';
                const url = `${API_URL}/products/search?query=${encodeURIComponent(query)}&category=${category}`;
                
                console.log(`üîÑ searchProducts called with query="${query}", category="${category}"`);
                console.log(`üì° Fetching from: ${url}`);
                
                const response = await fetch(url);
                console.log(`üì° Response status: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    throw new Error(`Failed to fetch products: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log(`üì¶ API Response:`, data);
                
                addResult(
                    'Frontend API Service ‚úÖ', 
                    'success', 
                    `SUCCESS! The exact same code that was throwing 404 now works. Found ${data.count} products.`
                );
                
            } catch (error) {
                addResult(
                    'Frontend API Service ‚ùå', 
                    'error', 
                    `FAILED: ${error.message}. This is the same error that was occurring before.`
                );
            }
        }
        
        async function testBothEndpoints() {
            addResult('Both Endpoints Test', 'loading', 'Testing both search endpoints...');
            
            try {
                // Test 1: Basic search endpoint
                const basicResponse = await fetch(`${API_URL}/products/search?query=shirts&category=fashion`);
                if (!basicResponse.ok) {
                    throw new Error(`Basic search failed: ${basicResponse.status}`);
                }
                const basicData = await basicResponse.json();
                
                // Test 2: Natural language search endpoint
                const nlResponse = await fetch(`${API_URL}/products/search-natural`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: 'blue shirts for men under 2000' })
                });
                if (!nlResponse.ok) {
                    throw new Error(`Natural language search failed: ${nlResponse.status}`);
                }
                const nlData = await nlResponse.json();
                
                addResult(
                    'Both Endpoints Test ‚úÖ', 
                    'success', 
                    `SUCCESS! Both endpoints working:<br>
                    ‚Ä¢ Basic search: ${basicData.count} products<br>
                    ‚Ä¢ Natural language: ${nlData.count} products<br>
                    The 404 error has been completely resolved!`
                );
                
            } catch (error) {
                addResult(
                    'Both Endpoints Test ‚ùå', 
                    'error', 
                    `FAILED: ${error.message}`
                );
            }
        }
        
        // Auto-run tests on page load
        window.onload = function() {
            setTimeout(() => {
                testDirectBackendCall();
                setTimeout(() => testFrontendApiService(), 1000);
                setTimeout(() => testBothEndpoints(), 2000);
            }, 500);
        };
    </script>
</body>
</html>