<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Body Fit Flow Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
        .product-card {
            border: 1px solid #e5e7eb;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: #f9fafb;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .product-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
        }
        button {
            background: linear-gradient(to right, #ec4899, #be185d);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        .log {
            background: #1f2937;
            color: #f3f4f6;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .body-shape-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .body-shape-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .body-shape-card:hover {
            border-color: #ec4899;
            background: #fdf2f8;
        }
        .recommendations {
            background: #ecfdf5;
            border: 1px solid #10b981;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üëï Enhanced Body Fit Flow Test</h1>
    
    <div class="test-section">
        <h2>üéØ Body Shape Recommendations System</h2>
        <p>Test the intelligent category recommendations based on body shapes.</p>
        
        <div class="body-shape-grid">
            <div class="body-shape-card" onclick="testBodyShape('women', 'Hourglass')">
                <h3>‚è≥ Women - Hourglass</h3>
                <p>Balanced proportions, defined waist</p>
                <small>Click to test recommendations</small>
            </div>
            <div class="body-shape-card" onclick="testBodyShape('women', 'Pear')">
                <h3>üçê Women - Pear</h3>
                <p>Wider hips, narrower shoulders</p>
                <small>Click to test recommendations</small>
            </div>
            <div class="body-shape-card" onclick="testBodyShape('women', 'Apple')">
                <h3>üçé Women - Apple</h3>
                <p>Fuller midsection, broader shoulders</p>
                <small>Click to test recommendations</small>
            </div>
            <div class="body-shape-card" onclick="testBodyShape('men', 'Rectangle')">
                <h3>üìê Men - Rectangle</h3>
                <p>Straight silhouette, minimal waist definition</p>
                <small>Click to test recommendations</small>
            </div>
            <div class="body-shape-card" onclick="testBodyShape('men', 'Triangle')">
                <h3>üî∫ Men - Triangle</h3>
                <p>Broader hips, narrower shoulders</p>
                <small>Click to test recommendations</small>
            </div>
            <div class="body-shape-card" onclick="testBodyShape('men', 'Inverted Triangle')">
                <h3>üîª Men - Inverted Triangle</h3>
                <p>Broad shoulders, narrow hips</p>
                <small>Click to test recommendations</small>
            </div>
        </div>
        
        <button onclick="testCompleteFlow()">üß™ Test Complete Flow</button>
        <button onclick="clearResults()">üßπ Clear Results</button>
        
        <div id="results"></div>
        <div id="log" class="log"></div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearResults() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('results').innerHTML = '';
        }

        async function testBodyShape(gender, bodyShape) {
            log(`üß™ Testing ${gender} ${bodyShape} body shape recommendations...`);
            
            const resultsDiv = document.getElementById('results');
            
            // Get recommendations for this body shape
            const recommendations = getRecommendations(gender, bodyShape);
            
            let html = `<div class="recommendations">`;
            html += `<h3>‚ú® Recommendations for ${bodyShape} ${gender}</h3>`;
            html += `<p><strong>Recommended Categories:</strong> ${recommendations.join(', ')}</p>`;
            html += `<p><strong>Why:</strong> ${getReasonForRecommendation(gender, bodyShape)}</p>`;
            html += `</div>`;
            
            // Test with first recommended category and a color
            const category = recommendations[0];
            const color = gender === 'women' ? 'Pink' : 'Blue';
            
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: JSON.stringify({
                            type: 'bodyFitFlow',
                            gender: gender.toLowerCase(),
                            bodyShape: bodyShape,
                            category: category,
                            color: color
                        })
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                log(`‚úÖ API Response: ${data.response}`);
                log(`üõçÔ∏è Products found: ${data.products ? data.products.length : 0}`);

                html += `<div class="test-section">`;
                html += `<h4>üõçÔ∏è Sample Products: ${color} ${category} for ${bodyShape} ${gender}</h4>`;
                html += `<p><strong>Response:</strong> ${data.response}</p>`;

                if (data.products && data.products.length > 0) {
                    data.products.slice(0, 3).forEach(product => {
                        html += `<div class="product-card">`;
                        html += `<img src="${product.product_image}" alt="${product.product_name}" class="product-image" onerror="this.src='https://via.placeholder.com/80x80/ec4899/ffffff?text=Product'">`;
                        html += `<div>`;
                        html += `<strong>${product.product_name}</strong><br>`;
                        html += `Color: ${product.color} | Gender: ${product.gender}<br>`;
                        html += `Category: ${product.product_category}<br>`;
                        html += `Price: ‚Çπ${product.price}`;
                        html += `</div>`;
                        html += `</div>`;
                    });
                } else {
                    html += `<p class="error">No products found for this combination.</p>`;
                }

                html += `</div>`;

            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                html += `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
            
            resultsDiv.innerHTML = html;
        }

        function getRecommendations(gender, bodyShape) {
            const recommendations = {
                'women': {
                    'Hourglass': ['Dresses', 'Western Wear', 'Tops and Co-ord Sets'],
                    'Pear': ['Tops and Co-ord Sets', 'Western Wear', 'Ethnic Wear'],
                    'Apple': ['Dresses', 'Tops and Co-ord Sets', 'Western Wear'],
                    'Rectangle': ['Dresses', 'Western Wear', 'Ethnic Wear'],
                    'Inverted Triangle': ['Dresses', 'Western Wear', 'Ethnic Wear']
                },
                'men': {
                    'Rectangle': ['Shirts', 'T-shirts', 'Hoodies'],
                    'Triangle': ['Shirts', 'Hoodies', 'T-shirts'],
                    'Inverted Triangle': ['T-shirts', 'Shirts', 'Hoodies'],
                    'Oval': ['Shirts', 'T-shirts', 'Hoodies'],
                    'Trapezoid': ['Shirts', 'T-shirts', 'Hoodies']
                }
            };
            
            return recommendations[gender.toLowerCase()][bodyShape] || [];
        }

        function getReasonForRecommendation(gender, bodyShape) {
            const reasons = {
                'women': {
                    'Hourglass': 'Emphasize your natural waist and balanced proportions',
                    'Pear': 'Balance your silhouette by highlighting your upper body',
                    'Apple': 'Create waist definition and elongate your torso',
                    'Rectangle': 'Add curves and create the illusion of a defined waist',
                    'Inverted Triangle': 'Balance broad shoulders with flowing lower garments'
                },
                'men': {
                    'Rectangle': 'Add structure and definition to your straight silhouette',
                    'Triangle': 'Balance proportions by enhancing your upper body',
                    'Inverted Triangle': 'Complement your broad shoulders without adding bulk',
                    'Oval': 'Streamline your silhouette with well-fitted garments',
                    'Trapezoid': 'Enhance your naturally strong upper body frame'
                }
            };
            
            return reasons[gender.toLowerCase()][bodyShape] || 'Enhance your natural body shape';
        }

        async function testCompleteFlow() {
            log('üöÄ Testing complete Body Fit flow...');
            
            const testCases = [
                { gender: 'women', bodyShape: 'Hourglass', category: 'Dresses', color: 'Red' },
                { gender: 'women', bodyShape: 'Pear', category: 'Tops and Co-ord Sets', color: 'Pink' },
                { gender: 'men', bodyShape: 'Rectangle', category: 'Shirts', color: 'Blue' },
                { gender: 'men', bodyShape: 'Inverted Triangle', category: 'T-shirts', color: 'Black' }
            ];
            
            let html = '<div class="test-section"><h3>üß™ Complete Flow Test Results</h3>';
            
            for (const testCase of testCases) {
                try {
                    const response = await fetch('http://localhost:5001/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message: JSON.stringify({
                                type: 'bodyFitFlow',
                                gender: testCase.gender,
                                bodyShape: testCase.bodyShape,
                                category: testCase.category,
                                color: testCase.color
                            })
                        })
                    });
                    
                    const data = await response.json();
                    const productCount = data.products ? data.products.length : 0;
                    
                    html += `<div style="margin: 10px 0; padding: 10px; background: #f0f9ff; border-radius: 5px;">`;
                    html += `<strong>${testCase.gender} ${testCase.bodyShape} + ${testCase.color} ${testCase.category}:</strong> `;
                    html += `<span class="${productCount > 0 ? 'success' : 'error'}">${productCount} products found</span>`;
                    html += `</div>`;
                    
                    log(`‚úÖ ${testCase.gender} ${testCase.bodyShape}: ${productCount} products`);
                    
                } catch (error) {
                    html += `<div style="margin: 10px 0; padding: 10px; background: #fef2f2; border-radius: 5px;">`;
                    html += `<strong>${testCase.gender} ${testCase.bodyShape}:</strong> <span class="error">Error</span>`;
                    html += `</div>`;
                    log(`‚ùå ${testCase.gender} ${testCase.bodyShape}: Error`);
                }
            }
            
            html += '</div>';
            document.getElementById('results').innerHTML = html;
        }

        // Auto-run on page load
        window.onload = function() {
            log('üöÄ Enhanced Body Fit Flow test page loaded');
            log('üí° Click on body shape cards to test recommendations');
        };
    </script>
</body>
</html>